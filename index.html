<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>soliloquy</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Favicon (동적으로 업데이트됨) -->
  <link id="favicon" rel="icon" type="image/png" href="">
  <link id="apple-touch-icon" rel="apple-touch-icon" href="">
  <meta id="theme-color" name="theme-color" content="#ffffff">
  <!-- Open Graph / Twitter Card (동적으로 업데이트됨) -->
  <meta id="og-image" property="og:image" content="">
  <meta id="twitter-image" name="twitter:image" content="">
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyBVNPLlTc4tzYvsKN28VQtOFCbMxe0Ikxo",
      authDomain: "hayagwi.firebaseapp.com",
      projectId: "hayagwi",
      storageBucket: "hayagwi.firebasestorage.app",
      messagingSenderId: "266700942737",
      appId: "1:266700942737:web:2370825405c9db9e537e30"
    };
    
    // Firebase 설정 검증
    function validateFirebaseConfig(config) {
      const required = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
      const missing = required.filter(key => !config[key] || config[key].includes('여기에') || config[key].includes('YOUR_'));
      
      if (missing.length > 0) {
        console.error('❌ Firebase 설정이 완료되지 않았습니다.');
        console.error('다음 항목을 설정해주세요:', missing.join(', '));
        console.error('설정 방법: Firebase 콘솔 → 프로젝트 설정 → 일반 → 내 앱 → 웹 앱 설정 정보 복사');
        console.error('자세한 방법은 FIREBASE_SETUP.md 파일을 참고하세요.');
        return false;
      }
      return true;
    }
    
    // Firebase 초기화
    if (validateFirebaseConfig(firebaseConfig)) {
      try {
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // 전역으로 사용할 수 있도록 설정
        window.firebaseDb = db;
        window.firebaseDoc = doc;
        window.firebaseGetDoc = getDoc;
        window.firebaseSetDoc = setDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseReady = true;
        
        console.log('✅ Firebase 초기화 완료');
        console.log('프로젝트 ID:', firebaseConfig.projectId);
        window.dispatchEvent(new Event('firebase-ready'));
      } catch (error) {
        console.error('❌ Firebase 초기화 실패:', error);
        console.error('에러 내용:', error.message);
        console.error('Firebase 설정 정보를 확인하세요.');
        window.firebaseReady = false;
      }
    } else {
      console.warn('⚠️ Firebase 설정이 완료되지 않아 로컬 저장소만 사용됩니다.');
      console.warn('다른 기기와 동기화하려면 Firebase 설정이 필요합니다.');
      window.firebaseReady = false;
      // Firebase 없이도 로컬 저장소는 사용 가능
      window.dispatchEvent(new Event('firebase-ready'));
    }
  </script>
</head>
<body>
  <header class="main-header">
    <div id="last-updated" class="last-updated"></div>
  </header>
  <!-- 모바일 전용 헤더 -->
  <header id="mobile-header" class="mobile-header" style="display: none;">
    <div id="mobile-transparency-btn-container"></div>
  </header>
  <main class="container">
    <h1 class="visually-hidden">메모 타임스탬프 앱</h1>
    <div class="main-content">
      <aside class="profile-section">
        <div class="profile-wrapper">
          <div class="profile-image">
            <img id="profile-img" src="" alt="프로필 사진" style="display: none;" />
            <div class="profile-image-placeholder">프로필 사진</div>
            <div id="profile-image-menu" class="profile-image-menu">
              <button type="button" class="profile-image-menu-item" id="profile-image-add">사진 추가</button>
              <button type="button" class="profile-image-menu-item delete" id="profile-image-delete">사진 삭제</button>
            </div>
            <input id="profile-image-input" type="file" accept="image/*" style="display: none;" />
          </div>
          <div class="profile-name">
            <input id="profile-name-input" class="profile-name-input" type="text" placeholder="이름을 입력하세요..." />
          </div>
          <div class="profile-bio">
            <textarea id="profile-bio-input" class="profile-bio-input" placeholder="소개를 입력하세요..." rows="1"></textarea>
          </div>
        </div>
      </aside>

      <div class="notes-section">
        <section class="composer" aria-labelledby="composer-label">
          <label id="composer-label" class="visually-hidden" for="note-input">글 작성</label>
          <div class="input-container">
            <textarea id="note-input" class="note-input" placeholder="여기에 글을 쓰세요..." rows="3"></textarea>
            <div id="upload-preview" class="upload-preview" style="display:none"></div>
            <div id="thread-indicator" class="thread-indicator" style="display: none;">
              <span class="thread-indicator-text"></span>
              <button id="cancel-thread" class="thread-cancel-btn" type="button">취소</button>
            </div>
          </div>
          <div class="actions">
            <input id="file-input" type="file" accept="image/*" multiple style="display:none" />
            <label for="file-input" id="upload-btn" class="btn btn-icon" role="button" aria-label="사진 첨부" tabindex="0">
              <img src="photo-icon.svg" alt="사진" style="width: 16px; height: 16px;" />
            </label>
            <button id="submit-btn" class="submit-btn" type="button" aria-label="전송">
              <img src="send-icon.svg" alt="전송" style="width: 16px; height: 16px;" />
            </button>
          </div>
        </section>

        <section class="list" aria-labelledby="list-label">
          <h2 id="list-label" class="visually-hidden">저장된 글 목록</h2>
          <div id="filter-info" class="filter-info">
            <span class="filter-info-text"></span>
            <button id="clear-filter" class="btn-clear-filter" type="button" style="display: none;">필터 해제</button>
          </div>
          <ul id="notes" class="notes" aria-live="polite"></ul>
        </section>
      </div>

      <aside class="calendar-section">
        <div class="calendar-wrapper">
          <div class="calendar-header">
            <button id="prev-month" class="btn-nav" type="button">‹</button>
            <span id="calendar-title" class="calendar-title"></span>
            <button id="next-month" class="btn-nav" type="button">›</button>
          </div>
          <div id="calendar" class="calendar"></div>
        </div>

        <div class="search-bar">
          <div class="search-input-wrapper">
            <input id="search-input" class="search-input" type="text" placeholder="검색어 입력" />
            <button id="search-btn" class="btn-search-icon" type="button" aria-label="검색">
              <img id="search-icon" src="search-icon.svg" alt="검색" style="display: block; width: 16px; height: 16px;" />
              <img id="close-icon" src="close-icon.svg" alt="닫기" style="display: none; width: 16px; height: 16px;" />
            </button>
          </div>
        </div>

        <div class="calendar-actions">
          <button id="toggle-transparency" class="btn" type="button">투명</button>
          <button id="toggle-date" class="btn" type="button">날짜</button>
          <button id="reset-btn" class="btn" type="button">초기화</button>
          <button id="restore-btn" class="btn" type="button" style="display: none;">복원</button>
          <button id="final-delete-btn" class="btn btn-delete" type="button" style="display: none;">진짜끝</button>
          <span id="total-notes-count" class="total-notes-count"></span>
        </div>

        <div class="bulk-actions" aria-label="일괄 작업">
          <button id="toggle-selection" class="btn" type="button">선택</button>
          <button id="select-all-btn" class="btn bulk-controls" type="button">전체</button>
          <button id="bulk-edit" class="btn bulk-controls" type="button">수정</button>
          <button id="bulk-delete" class="btn btn-delete bulk-controls" type="button">삭제</button>
        </div>

        <div class="folder-section">
          <div class="folder-header">
            <button id="toggle-folder" class="btn" type="button">폴더</button>
            <div class="folder-controls" style="display: none;">
              <button id="folder-add" class="btn" type="button">추가</button>
              <button id="folder-edit" class="btn" type="button">수정</button>
              <button id="folder-remove" class="btn" type="button">해제</button>
              <button id="folder-delete" class="btn btn-delete" type="button">삭제</button>
            </div>
          </div>
          <div id="folder-list" class="folder-list" style="display: none;"></div>
        </div>
      </aside>
    </div>
  </main>

  <div id="image-modal" class="image-modal" role="dialog" aria-modal="true" aria-label="이미지 보기">
    <button id="image-modal-close" class="image-modal-close" type="button">닫기</button>
    <button id="image-modal-prev" class="image-modal-nav image-modal-prev" type="button" aria-label="이전 이미지">‹</button>
    <button id="image-modal-next" class="image-modal-nav image-modal-next" type="button" aria-label="다음 이미지">›</button>
    <div class="image-modal-content">
      <img id="image-modal-img" alt="전체 이미지" />
    </div>
  </div>

  <div id="toast" class="toast" style="display: none;"></div>

  <div id="reset-confirm-modal" class="reset-confirm-modal" style="display: none;">
    <div class="reset-confirm-content">
      <p>정말 초기화하시겠습니까?</p>
      <div class="reset-confirm-buttons">
        <button id="reset-confirm-yes" class="btn" type="button">네</button>
        <button id="reset-confirm-no" class="btn btn-cancel" type="button">아니요</button>
      </div>
    </div>
  </div>



  <script src="script.js"></script>
</body>
</html>


